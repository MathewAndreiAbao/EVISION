import{d as wt,b as y,a as u,f as p,s as v}from"../chunks/BGsM1btW.js";import{p as kt,d as L,f as St,o as $t,t as U,g as e,a as Dt,e as Lt,c as s,s as l,b as w,$ as Ut,r,i as M}from"../chunks/DEPQPQt8.js";import{i as At}from"../chunks/CVvYbTkW.js";import{e as z,i as V}from"../chunks/DFPLsyL_.js";import{h as Ct,b as Et,s as G,r as Mt,a as rt}from"../chunks/BFGHZJqN.js";import{b as zt}from"../chunks/CEtDmXYx.js";import{a as Vt,s as jt}from"../chunks/DNJl1ib1.js";import{p as Bt}from"../chunks/CSn65FV0.js";import{S as st}from"../chunks/81uDzRXJ.js";import{normalizeComplianceStatus as ot}from"../chunks/DmYj-g2y.js";var Nt=p("<option> </option>"),Rt=p('<div class="glass-card-static p-6 animate-pulse"><div class="h-4 bg-gray-200 rounded w-3/4 mb-3"></div> <div class="h-3 bg-gray-200 rounded w-1/2"></div></div>'),Tt=p('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>'),qt=p('<div class="text-center py-20"><p class="text-xl font-semibold text-text-primary">No documents found</p> <p class="text-base text-text-muted mt-2"> </p></div>'),It=p('<div class="glass-card p-5 cursor-pointer"><div class="flex items-start gap-4"><div class="w-12 h-12 rounded-xl bg-gradient-to-br from-gov-blue/10 to-gov-blue/5 flex items-center justify-center text-xs font-bold text-gov-blue flex-shrink-0"> </div> <div class="flex-1 min-w-0"><p class="text-sm font-semibold text-text-primary truncate"> </p> <p class="text-xs text-text-muted mt-1"> </p> <div class="flex items-center justify-between mt-3"><!> <span class="text-xs text-text-muted"> </span></div></div> <div class="flex flex-col gap-2 flex-shrink-0 ml-2"><button class="p-2 text-gov-blue hover:bg-gov-blue/10 rounded-lg transition-all text-xs font-bold uppercase" title="View">VIEW</button> <button class="p-2 text-gov-blue hover:bg-gov-blue/10 rounded-lg transition-all text-xs font-bold uppercase" title="Download">GET</button></div></div></div>'),Ot=p('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>'),Pt=p('<tr class="hover:bg-white/40 transition-colors"><td class="px-6 py-4"><div class="flex items-center gap-3"><span class="text-sm font-medium text-text-primary"> </span></div></td><td class="px-6 py-4 text-sm text-text-secondary hidden md:table-cell"> </td><td class="px-6 py-4 text-sm text-text-muted hidden lg:table-cell"> </td><td class="px-6 py-4"><!></td><td class="px-6 py-4"><span class="text-sm text-text-muted hidden sm:inline-block mr-4"> </span></td><td class="px-6 py-4 text-right"><div class="flex items-center justify-end gap-2"><button class="p-2 text-text-muted hover:text-gov-blue hover:bg-gov-blue/10 rounded-lg transition-colors" title="View">VIEW</button> <button class="p-2 text-text-muted hover:text-gov-blue hover:bg-gov-blue/10 rounded-lg transition-colors" title="Download">GET</button></div></td></tr>'),Ft=p('<div class="glass-card-static overflow-hidden"><table class="w-full"><thead><tr class="border-b border-gray-100"><th class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wide">Document</th><th class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wide hidden md:table-cell">Type</th><th class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wide hidden lg:table-cell">Size</th><th class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wide">Status</th><th class="px-6 py-4 text-left text-xs font-semibold text-text-muted uppercase tracking-wide hidden sm:table-cell">Date</th><th class="px-6 py-4 text-right text-xs font-semibold text-text-muted uppercase tracking-wide">Actions</th></tr></thead><tbody class="divide-y divide-gray-50"></tbody></table></div>'),Gt=p('<div><div class="mb-8"><h1 class="text-2xl font-bold text-text-primary">Document Archive</h1> <p class="text-base text-text-secondary mt-1">Browse and search your archived instructional records</p></div> <div class="glass-card-static p-4 mb-6 flex flex-col sm:flex-row items-stretch sm:items-center gap-4"><div class="flex-1 relative"><input type="text" placeholder="Search by filename or SHA-256 hash..." class="w-full px-4 py-3 text-sm bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-gov-blue/30 focus:border-gov-blue outline-none min-h-[48px]"/></div> <select class="px-4 py-3 text-sm bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-gov-blue/30 focus:border-gov-blue outline-none min-h-[48px]"></select> <div class="flex rounded-xl border border-gray-200 overflow-hidden"><button>Grid</button> <button>List</button></div></div> <!></div>');function ae(it,lt){kt(lt,!0);const J=()=>jt(Bt,"$profile",dt),[dt,nt]=Vt();let W=L(St([])),H=L(!0),k=L(""),S=L("grid"),A=L("all");const ct=["all","January","February","March","April","May","June","July","August","September","October","November","December"];$t(async()=>{await vt(),w(H,!1)});async function vt(){let t=G.from("submissions").select("*").order("created_at",{ascending:!1});J()?.role==="Teacher"&&(t=t.eq("user_id",J().id));const{data:a}=await t;w(W,a||[],!0)}const j=M(()=>()=>{let t=e(W);if(e(k)){const a=e(k).toLowerCase();t=t.filter(o=>o.file_name.toLowerCase().includes(a)||o.file_hash.toLowerCase().includes(a)||o.doc_type?.toLowerCase().includes(a))}return e(A)!=="all"&&(t=t.filter(a=>new Date(a.created_at).toLocaleString("en",{month:"long"})===e(A))),t});function K(t){return new Date(t).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"})}function ut(t){return t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB"}async function pt(t){const{data:a,error:o}=await G.storage.from("submissions").createSignedUrl(t,3600);return o?(console.error("Error getting signed URL:",o),null):a.signedUrl}async function Q(t){const a=t.file_path||`${t.id}/${t.file_name}`,o=await pt(a);o?window.open(o,"_blank"):alert("Could not retrieve file. Please try again.")}async function X(t){const a=t.file_path||`${t.id}/${t.file_name}`,{data:o,error:i}=await G.storage.from("submissions").download(a);if(i){console.error("Download error:",i),alert("Download failed.");return}const n=URL.createObjectURL(o),d=document.createElement("a");d.href=n,d.download=t.file_name,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n)}var B=Gt();Ct("15mknmq",t=>{Lt(()=>{Ut.title="Archive — Smart E-VISION"})});var N=l(s(B),2),R=s(N),Y=s(R);Mt(Y),r(R);var C=l(R,2);z(C,21,()=>ct,V,(t,a)=>{var o=Nt(),i=s(o,!0);r(o);var n={};U(()=>{v(i,e(a)==="all"?"All Months":e(a)),n!==(n=e(a))&&(o.value=(o.__value=e(a))??"")}),u(t,o)}),r(C);var Z=l(C,2),T=s(Z),tt=l(T,2);r(Z),r(N);var xt=l(N,2);{var mt=t=>{var a=Tt();z(a,20,()=>Array(6),V,(o,i)=>{var n=Rt();u(o,n)}),r(a),u(t,a)},ft=t=>{var a=qt(),o=l(s(a),2),i=s(o,!0);r(o),r(a),U(()=>v(i,e(k)?"Try a different search term":"Upload your first document to get started")),u(t,a)},gt=M(()=>e(j)().length===0),bt=t=>{var a=Ot();z(a,21,()=>e(j)(),V,(o,i)=>{var n=It(),d=s(n),x=s(d),$=s(x,!0);r(x);var f=l(x,2),g=s(f),q=s(g,!0);r(g);var m=l(g,2),I=s(m);r(m);var b=l(m,2),E=s(b);{let c=M(()=>ot(e(i).compliance_status));st(E,{get status(){return e(c)},size:"sm"})}var _=l(E,2),O=s(_,!0);r(_),r(b),r(f);var h=l(f,2),D=s(h),P=l(D,2);r(h),r(d),r(n),U(c=>{v($,e(i).doc_type),v(q,e(i).file_name),v(I,`${e(i).doc_type??""} • Week ${(e(i).week_number||"?")??""}`),v(O,c)},[()=>K(e(i).created_at)]),y("click",D,c=>{c.stopPropagation(),Q(e(i))}),y("click",P,c=>{c.stopPropagation(),X(e(i))}),u(o,n)}),r(a),u(t,a)},_t=t=>{var a=Ft(),o=s(a),i=l(s(o));z(i,21,()=>e(j)(),V,(n,d)=>{var x=Pt(),$=s(x),f=s($),g=s(f),q=s(g,!0);r(g),r(f),r($);var m=l($),I=s(m,!0);r(m);var b=l(m),E=s(b,!0);r(b);var _=l(b),O=s(_);{let F=M(()=>ot(e(d).compliance_status));st(O,{get status(){return e(F)},size:"sm"})}r(_);var h=l(_),D=s(h),P=s(D,!0);r(D),r(h);var c=l(h),et=s(c),at=s(et),ht=l(at,2);r(et),r(c),r(x),U((F,yt)=>{v(q,e(d).file_name),v(I,e(d).doc_type),v(E,F),v(P,yt)},[()=>ut(e(d).file_size),()=>K(e(d).created_at)]),y("click",at,()=>Q(e(d))),y("click",ht,()=>X(e(d))),u(n,x)}),r(i),r(o),r(a),u(t,a)};At(xt,t=>{e(H)?t(mt):e(gt)?t(ft,1):e(S)==="grid"?t(bt,2):t(_t,!1)})}r(B),U(()=>{rt(T,1,`px-4 py-3 text-sm font-medium min-h-[48px] transition-colors ${e(S)==="grid"?"bg-gov-blue text-white":"bg-white/50 text-text-muted hover:text-text-primary"}`),rt(tt,1,`px-4 py-3 text-sm font-medium min-h-[48px] transition-colors ${e(S)==="list"?"bg-gov-blue text-white":"bg-white/50 text-text-muted hover:text-text-primary"}`)}),zt(Y,()=>e(k),t=>w(k,t)),Et(C,()=>e(A),t=>w(A,t)),y("click",T,()=>w(S,"grid")),y("click",tt,()=>w(S,"list")),u(it,B),Dt(),nt()}wt(["click"]);export{ae as component};
