import{_ as Ae}from"../chunks/PPVm8Dsz.js";import{a as J,f as Q,s as ce}from"../chunks/BGsM1btW.js";import{p as $e,f as K,d as I,o as Te,j as We,a as je,e as ze,c as a,b as O,x as de,g,$ as De,s as p,r as s,n as k,h as Ee,t as Ie}from"../chunks/DEPQPQt8.js";import{i as Oe}from"../chunks/CVvYbTkW.js";import{t as T,a as Pe,f as P}from"../chunks/tw1RdNRP.js";import{h as Le,s as x,a as Me}from"../chunks/BFGHZJqN.js";import{b as pe}from"../chunks/REG38ZGk.js";import{a as Xe,s as Ye}from"../chunks/DNJl1ib1.js";import{p as Ze}from"../chunks/CSn65FV0.js";import{getSubmissionWeek as Ne,calculateCompliance as me}from"../chunks/DmYj-g2y.js";import{R as Fe,D as Ge,C as He,A as Ve,T as qe,Z as Be}from"../chunks/D12q7Q36.js";import{T as Je}from"../chunks/lxx4mEY1.js";function Ke(W,Z=8){if(!W||W.length<2)return{riskScore:0,label:"On-Track",trend:"Stable",message:"Insufficent data for predictive modeling."};const j=[...W].sort((i,R)=>R.week_number-i.week_number).slice(0,Z).reverse().map((i,R)=>({x:R,y:i.compliance_status==="compliant"?0:i.compliance_status==="late"?1:2})),h=j.length;if(h<2)return{riskScore:0,label:"On-Track",trend:"Stable",message:"Steady state."};let y=0,_=0,w=0,z=0;for(const i of j)y+=i.x,_+=i.y,w+=i.x*i.y,z+=i.x*i.x;const f=(h*w-y*_)/(h*z-y*y),D=_/h,m=j[h-1].y;let o=D*20+m*20+f*30,u=Math.min(100,Math.max(0,Math.round(o*20))),v="On-Track";u>70?v="Critical":u>35&&(v="At-Risk");let C="Stable";f>.1?C="Declining":f<-.1&&(C="Improving");let S="Maintaining consistent submission patterns.";return v==="Critical"?S="Highly likely to miss or delay next week's submission based on recent breakdown.":v==="At-Risk"?S="Compliance consistency is wavering; monitor next week closely.":C==="Improving"&&(S="Compliance habits are showing positive momentum."),{riskScore:u,label:v,trend:C,message:S}}var Qe=Q('<div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="glass-card-static h-96 animate-pulse"></div> <div class="glass-card-static h-96 animate-pulse"></div></div>'),Ue=Q('<div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="glass-card-static p-8"><div class="flex items-center justify-between mb-8"><div class="flex items-center gap-3"><div class="p-2 rounded-lg bg-gov-blue/10 text-gov-blue"><!></div> <h3 class="text-sm font-black text-text-primary uppercase tracking-widest">Global Trend</h3></div> <div class="px-3 py-1 bg-gov-green/10 text-gov-green rounded-full text-[10px] font-black uppercase tracking-widest">8-Week Window</div></div> <div class="h-72"><canvas></canvas></div></div> <div class="glass-card-static p-8"><div class="flex items-center justify-between mb-8"><div class="flex items-center gap-3"><div class="p-2 rounded-lg bg-gov-blue/10 text-gov-blue"><!></div> <h3 class="text-sm font-black text-text-primary uppercase tracking-widest">School Comparison</h3></div></div> <div class="h-72"><canvas></canvas></div></div></div> <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-10"><div class="glass-card-static p-8 text-center group"><div class="w-16 h-16 rounded-2xl bg-gov-blue/5 text-gov-blue flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-500"><!></div> <p class="text-4xl font-black text-gov-blue tracking-tighter"> </p> <p class="text-xs font-bold text-text-muted mt-2 uppercase tracking-widest">Growth Since Week 1</p></div> <div class="glass-card-static p-8 text-center group"><div class="w-16 h-16 rounded-2xl bg-gov-green/5 text-gov-green flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-500"><!></div> <p class="text-4xl font-black text-gov-green tracking-tighter">80%</p> <p class="text-xs font-bold text-text-muted mt-2 uppercase tracking-widest">Operational Target</p></div> <div class="glass-card-static p-8 text-center group"><div class="w-16 h-16 rounded-2xl bg-gov-gold/5 text-gov-gold flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-500"><!></div> <div class="flex items-center justify-center gap-2 mb-1"><p> </p></div> <p class="text-[10px] font-black uppercase tracking-widest text-text-muted opacity-50">Predictive Compliance Forecast</p></div></div>',1),et=Q(`<div><div class="mb-10 flex items-start justify-between"><div><h1 class="text-3xl font-black text-text-primary tracking-tight">Institutional Analytics</h1> <p class="text-base text-text-secondary mt-1 font-medium">Longitudinal performance tracking and predictive compliance
                modeling</p></div> <div class="flex items-center gap-3"><button class="p-2.5 rounded-xl bg-surface-muted text-text-secondary hover:text-gov-blue transition-colors border border-border-subtle shadow-sm"><!></button> <button class="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-gov-blue text-white text-sm font-bold shadow-lg shadow-gov-blue/20 hover:bg-gov-blue-dark transition-all"><!> Export Data</button></div></div> <!></div>`);function vt(W,Z){$e(Z,!0);const j=()=>Ye(Ze,"$profile",h),[h,y]=Xe();let _=I(void 0),w=I(void 0),z=I(!0),f=null,D,m=null,o=null,u=K({currentCompliance:0,improvement:0,topSchools:0}),v=I(K({riskScore:0,label:"On-Track",trend:"Stable",message:"Calculating predictive model..."}));Te(async()=>{const{Chart:r,registerables:t}=await Ae(async()=>{const{Chart:l,registerables:c}=await import("../chunks/BcLaVOC9.js");return{Chart:l,registerables:c}},[],import.meta.url);r.register(...t),f=r;const{weeklyData:e,schoolData:n}=await i();O(z,!1),await de(),U(e,n),C()}),We(()=>{D&&x.removeChannel(D),m&&m.destroy(),o&&o.destroy()});function C(){D=x.channel("analytics-dashboard").on("postgres_changes",{event:"*",schema:"public",table:"submissions"},async()=>{const{weeklyData:r,schoolData:t}=await i();S(r,t)}).subscribe()}async function S(r,t){if(!m||!o){await de(),U(r,t);return}m.data.datasets[0].data=r,m.update(),o.data.labels=t.map(e=>e.name),o.data.datasets[0].data=t.map(e=>e.compliant),o.data.datasets[1].data=t.map(e=>e.late),o.data.datasets[2].data=t.map(e=>e.nonCompliant),o.update()}async function i(){if(!j())return{weeklyData:[],schoolData:[]};const t=await ve(),e=await ue();u.currentCompliance=t[t.length-1]||0,u.improvement=t[0]?u.currentCompliance-t[0]:0,u.topSchools=e.filter(l=>l.rate>=80).length;const{data:n}=await x.from("submissions").select("week_number, compliance_status").order("week_number",{ascending:!0});return O(v,Ke(n||[]),!0),{weeklyData:t,schoolData:e}}let R=I(K([]));async function ve(){const[r,t]=await Promise.all([x.from("submissions").select("compliance_status, week_number, created_at"),x.from("academic_calendar").select("week_number").eq("school_year","2025-2026").order("week_number",{ascending:!0})]),e=r.data||[],n=t.data||[],l=n.length>0?n.map(c=>c.week_number):[1,2,3,4,5,6,7,8];return O(R,l.map(c=>`Week ${c}`),!0),l.map(c=>{const b=e.filter(A=>Ne(A)===c);return me(b).rate})}async function ue(){const[r,t,e]=await Promise.all([x.from("schools").select("id, name"),x.from("submissions").select("compliance_status, uploader:profiles!inner(school_id)"),x.from("teaching_loads").select("id, profiles!inner(school_id)")]),n=r.data||[],l=t.data||[],c=e.data||[];return n.map(b=>{const M=l.filter(d=>(Array.isArray(d.uploader)?d.uploader[0]:d.uploader)?.school_id===b.id),A=c.filter(d=>(Array.isArray(d.profiles)?d.profiles[0]:d.profiles)?.school_id===b.id).length,$=me(M,A);return{name:b.name.replace(" Elementary School"," ES"),compliant:$.Compliant,late:$.Late,nonCompliant:$.NonCompliant,rate:$.rate}})}function U(r,t){f&&(m&&m.destroy(),o&&o.destroy(),m=new f(g(_),{type:"line",data:{labels:g(R),datasets:[{label:"Compliance Rate (%)",data:r,borderColor:"#0038A8",backgroundColor:"rgba(0, 56, 168, 0.1)",fill:!0,tension:.4,pointRadius:5,pointHoverRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:e=>e+"%"}}}}}),o=new f(g(w),{type:"bar",data:{labels:t.map(e=>e.name),datasets:[{label:"Compliant",data:t.map(e=>e.compliant),backgroundColor:"#008751"},{label:"Late",data:t.map(e=>e.late),backgroundColor:"#FCD116"},{label:"Non-compliant",data:t.map(e=>e.nonCompliant),backgroundColor:"#CE1126"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}}}}))}var L=et();Le("1d0h3tk",r=>{ze(()=>{De.title="Analytics â€” Smart E-VISION"})});var N=a(L),ee=p(a(N),2),F=a(ee),ge=a(F);Fe(ge,{size:18}),s(F);var te=p(F,2),fe=a(te);Ge(fe,{size:18}),k(),s(te),s(ee),s(N);var be=p(N,2);{var xe=r=>{var t=Qe();J(r,t)},he=r=>{var t=Ue(),e=Ee(t),n=a(e),l=a(n),c=a(l),b=a(c),M=a(b);Je(M,{size:20}),s(b),k(2),s(c),k(2),s(l);var A=p(l,2),$=a(A);pe($,B=>O(_,B),()=>g(_)),s(A),s(n);var d=p(n,2),E=a(d),ae=a(E),se=a(ae),_e=a(se);He(_e,{size:20}),s(se),k(2),s(ae),s(E);var re=p(E,2),ke=a(re);pe(ke,B=>O(w,B),()=>g(w)),s(re),s(d),s(e);var ie=p(e,2),X=a(ie),G=a(X),ye=a(G);Ve(ye,{size:32,strokeWidth:1.5}),s(G);var oe=p(G,2),we=a(oe);s(oe),k(2),s(X);var Y=p(X,2),ne=a(Y),Ce=a(ne);qe(Ce,{size:32,strokeWidth:1.5}),s(ne),k(4),s(Y);var H=p(Y,2),V=a(H),Se=a(V);Be(Se,{size:32,strokeWidth:1.5}),s(V);var le=p(V,2),q=a(le),Re=a(q);s(q),s(le),k(2),s(H),s(ie),Ie(()=>{ce(we,`+${u.improvement??""}%`),Me(q,1,`text-4xl font-black tracking-tighter ${g(v).label==="Critical"?"text-gov-red":g(v).label==="At-Risk"?"text-gov-gold-dark":"text-gov-green"}`),ce(Re,`${g(v).riskScore??""}%`)}),T(1,n,()=>P,()=>({y:20,duration:600})),T(1,d,()=>P,()=>({y:20,duration:600,delay:200})),T(1,X,()=>P,()=>({y:20,duration:600,delay:400})),T(1,Y,()=>P,()=>({y:20,duration:600,delay:500})),T(1,H,()=>P,()=>({y:20,duration:600,delay:600})),J(r,t)};Oe(be,r=>{g(z)?r(xe):r(he,!1)})}s(L),T(1,L,()=>Pe,()=>({duration:400})),J(W,L),je(),y()}export{vt as component};
